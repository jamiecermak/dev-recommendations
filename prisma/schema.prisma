// Prisma Schema Docs: https://pris.ly/d/prisma-schema

generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["jsonProtocol"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id           String        @id @default(cuid())
    clerkId      String        @map("clerk_id")
    isActive     Boolean       @map("is_active")
    createdAt    DateTime      @default(now()) @map("created_at")
    updatedAt    DateTime      @updatedAt @map("updated_at")
    teamMembers  TeamMember[]
    createdTeams Team[]        @relation("CreatedTeams")
    ownedTeams   Team[]        @relation("OwnedTeams")
    InviteCodes  InviteCodes[]

    @@unique(clerkId)
    @@map("users")
}

model Team {
    id              String       @id @default(cuid())
    name            String
    createdByUserId String       @map("created_by_user_id")
    ownedByUserId   String       @map("owned_by_user_id")
    createdAt       DateTime     @default(now()) @map("created_at")
    updatedAt       DateTime     @updatedAt @map("updated_at")
    teamMembers     TeamMember[]

    createdByUser User @relation("CreatedTeams", fields: [createdByUserId], references: [id])
    ownedByUser   User @relation("OwnedTeams", fields: [ownedByUserId], references: [id])

    @@map("teams")
}

model TeamMember {
    teamId    String   @map("team_id")
    userId    String   @map("user_id")
    isAdmin   Boolean  @default(false) @map("is_admin")
    isActive  Boolean  @default(true) @map("is_active")
    joinedAt  DateTime @default(now()) @map("joined_at")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    team Team @relation(fields: [teamId], references: [id])
    user User @relation(fields: [userId], references: [id])

    @@id([teamId, userId])
    @@map("team_members")
}

model InviteCodes {
    id              String   @id @default(cuid())
    token           String
    invitedByUserId String   @map("invited_by_user_id")
    emailAddress    String   @map("email_address")
    teamId          String   @map("team_id")
    isUsed          Boolean  @map("is_used")
    usedAt          DateTime @map("used_at")
    createdAt       DateTime @default(now()) @map("created_at")
    updatedAt       DateTime @updatedAt @map("updated_at")
    expiresAt       DateTime @map("expires_at")

    invitedByUser User @relation(fields: [invitedByUserId], references: [id])

    @@map("invite_codes")
}
